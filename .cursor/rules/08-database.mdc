# Banco de Dados

## Tecnologias

- **PostgreSQL 16+**: Banco principal
- **Flyway**: Migrations
- **Hibernate Panache**: ORM

## Migrations

### Localização

```
src/main/resources/db/migration/
├── V1__create_tenant_table.sql
├── V2__create_users_table.sql
├── ...
```

### Convenção de Nomes

```
V{número}__{descrição}.sql
```

- `V1__create_xxx_table.sql` - Criação de tabela
- `V2__add_column_to_xxx.sql` - Alteração de tabela
- `V3__insert_xxx.sql` - Dados iniciais
- `V4__create_xxx_indexes.sql` - Índices

### Exemplo de Migration

```sql
-- V10__create_nova_tabela.sql

CREATE TABLE nova_tabela (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    nome VARCHAR(255) NOT NULL,
    active BOOLEAN NOT NULL DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

-- Índices
CREATE INDEX idx_nova_tabela_tenant ON nova_tabela(tenant_id);

-- Comentários
COMMENT ON TABLE nova_tabela IS 'Descrição da tabela';
```

## Convenções de Tabelas

- Nomes em `snake_case`
- Sempre ter `id`, `created_at`, `updated_at`
- Usar `UUID` para chaves primárias

## Tipos Customizados

```sql
-- Enum para roles
CREATE TYPE user_role AS ENUM ('USER', 'ADMIN', 'SUPER_ADMIN');

-- Uso
role user_role NOT NULL DEFAULT 'USER'
```

## Índices Obrigatórios

- Campos de busca frequente
- Foreign keys

## Configuração

```properties
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=${DB_URL:jdbc:postgresql://localhost:5432/futebol}
quarkus.hibernate-orm.database.generation=none
quarkus.flyway.migrate-at-start=true
```
